---
title: "STAT112 Project"
author: "Jenny Li, Geven Liu, Wenxuan Zhu"
date: '2022-04-16'
output: html_document
---
```{r}
library(tidyverse)
library(lubridate)
library(ggthemes) 
library(geofacet)
library(openintro)
library(gplots)
library(RColorBrewer)
library(ggthemes)     
library(plotly) 
library(gganimate)
library(gifski) 
library(transformr) 
library(patchwork) 
library(survival)

Employee <- read.csv('Employee.csv')

```


# Monthly Income Histogram

```{r, fig.alt= "The monthly income distributions in the dataset using a density plot with the blue line showing the mean monthly income for all workers" }
 Employee %>% 
  ggplot(aes(x = MonthlyIncome)) +
  geom_histogram(aes(y=..density..), color = "#E95C20FF", fill = "#F0B67F", bins = 40) +
  geom_vline(aes(xintercept = mean(MonthlyIncome)), color = "#4F2C1DFF", size = 1.5) +
  geom_density(alpha=.5, fill="#006747FF") + 
  labs(title = "Monthly Income Distributions", 
       subtitle = "Histogram Plot",
       x = NULL,
       y = NULL)
```

The above plot generally captures the overall income distribution in this company using the histogram plot form while the green part indicates the density over all employees. The dark brown line indicates the mean monthly income for all workers. Overall, the skewed distribution shows that most workers receive a monthly lower than the average, while a few people receive a monthly income far higher than the average income in this company.

# Monthly Income by department (boxplot)

```{r}
 Employee %>% 
  ggplot(aes(x = MonthlyIncome, color = Gender)) +
  geom_boxplot(alpha = 0.2 ) +
  geom_vline(aes(xintercept = mean(MonthlyIncome)), color = "#4F2C1DFF", size = 1) +
  facet_wrap(vars (Department)) + 
  scale_color_manual(values = c("Female" = "#E95C20FF",
                                "Male"="#006747FF")) + 
  labs(title = "Monthly Income Distributions by department", 
       subtitle = "Histogram Plot",
       x = NULL,
       y = NULL)
```


# Average income vs total working years by department

```{r}
Employee %>%
  group_by(Department,TotalWorkingYears,Attrition) %>%
  summarize(`Average income` = mean(MonthlyIncome)) %>%
  ggplot(aes(x=TotalWorkingYears)) +
  geom_point(size=1,
            aes( y=`Average income`,
            color=Attrition))+
  geom_smooth(aes(y=`Average income`,
             color=Attrition),
             se = FALSE,n=30,size=0.7)+
  facet_wrap(~Department)+
  theme_classic()+
  labs(x='Total working years')
```

In the above graph, we try to explore the relationship between average monthly salary and total working years by department. In this graph, we find that:

1. There is no clear discernable pattern about one department having consistently higher salaries than others;
2. For human resources in particular, for those with attrition status of 1(YES), there is not datapoint that have worked more than 25 years. We are not surprised given that human resources have the fewest employees in this dataset.
3. Overall, income is quite positively correlated with total working years; however, individual variation is substantial.
4. By eyeballing, attrition status might be correlated with income levels within R&D department, but no such pattern is observable within Human Resources of Sales department.


# attrition vs total working years (Kaplan Meier survival curve)

```{r}
es<-Employee%>%
  mutate(attrition=ifelse(Attrition=="YES",0,1))
km<-survfit(Surv(YearsAtCompany,attrition)~1,data=es)
plot(km,conf.int=TRUE)
```






