---
title: "STAT112 Project"
author: "Jenny Li, Geven Liu, Wenxuan Zhu"
date: '2022-04-16'
output: html_document
---
```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE, error=TRUE, message=FALSE, warning=FALSE)
```

##Library
```{r libraries}
library(tidyverse)     # for data cleaning and plotting
library(lubridate)     # for date manipulation
library(openintro)     # for the abbr2state() function
library(gplots)        # for col2hex() function
library(RColorBrewer)  # for color palettes
library(sf)            # for working with spatial data
library(leaflet)       # for highly customizable mapping
library(ggthemes)      # for more themes (including theme_map())
library(plotly)        # for the ggplotly() - basic interactivity
library(gganimate)     # for adding animation layers to ggplots
library(transformr)    # for "tweening" (gganimate)
library(gifski)        # need the library for creating gifs but don't need to load each tim
library(readr)
theme_set(theme_minimal())
```

##Data
```{r Data}
Employee <- read_csv("Employee.csv")
```

##Employees' Job Satisfaction By Department Along With Their Education Field
```{r animation, eval=FALSE, fig.alt="Employees' Job Satisfaction By Department Along With Their Education Field"}
Employee %>%
  ggplot(
    aes(
      x = JobSatisfaction,
      y = Age,
      color = EducationField,
      shape = EducationField
    )
  ) +
  geom_point() +
  labs(
    title = "Employees' Job Satisfaction By Department Along With Education Field",
    subtitle = "Department: {closest_state}",
    x = "Satification Rate",
    y = "Age",
  ) +
  theme(legend.position = "top",
        legend.title = element_blank()) +
  transition_states(Department, transition_length = 2,
                    state_length = 6) +
  exit_shrink() +
  enter_recolor(color = "lightblue") +
  exit_recolor(color = "lightblue")
```

```{r, eval=FALSE, echo=FALSE}
anim_save("Employees' Job Satisfaction By Department Along With Education Field.gif")
```

```{r, echo=FALSE}
knitr::include_graphics("Employees' Job Satisfaction By Department Along With Education Field.gif")
```

## Attrition
```{r,eval=FALSE, fig.alt="Comparision of Attrited and Not Attrited Employee Number by Department over Age"}
newEmployee <- Employee %>%
  group_by(Department, Age) %>%
  summarise(attrited = sum(Attrition == "Yes"),
            notAttrited = sum(Attrition == "No")) %>%
  mutate(newDepartment = ifelse(
    Department == "Sales",
    "Attrited Sales",
    ifelse(
      Department == "Human Resources",
      "Attrited Human Resources",
      ifelse(
        Department == "Research & Development",
        "Attrited Research & Development",
        "NA"
      )
    )
  ))

newEmployee %>%
  ggplot() +
  geom_line(aes(x = Age, y = attrited, color = Department),
            size = 1,
            linetype = "dashed") +
  geom_line(aes(x = Age, y = notAttrited, color = Department), size = 1) +
  geom_text(aes(
    x = Age,
    y = notAttrited,
    label = Department,
    color = Department
  )) +
  geom_text(aes(
    x = Age,
    y = attrited,
    label = newDepartment,
    color = newDepartment
  )) +
  labs(
    title = "Comparision of Attrited and Not Attrited Employee Number by Department over Age",
    subtitle = "Age: {frame_along}",
    x = "",
    y = ""
  ) +
  scale_color_manual(
    values = c(
      "Sales" = "brown4",
      "Attrited Sales" = "brown4",
      "Human Resources" = "deepskyblue4",
      "Attrited Human Resources" = "deepskyblue4",
      "Research & Development" = "gray65",
      "Attrited Research & Development" = "gray65"
    )
  ) +
  theme(
    legend.position = "none",
    plot.title = element_text(color = "#006bb3", size = 10.5,face = "bold",hjust = 1),
    plot.subtitle = element_text(color = "#006bb3")
  ) +
  transition_reveal(as.integer(Age))
```

```{r, eval=FALSE, echo=FALSE}
anim_save("Comparision of Attrited and Not Attrited Employee Number by Department over Age.gif")
```

```{r, echo=FALSE}
knitr::include_graphics("Comparision of Attrited and Not Attrited Employee Number by Department over Age.gif")
```
